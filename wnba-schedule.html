<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>WNBA Schedule Scraper</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      background: #13131c;
      color: #ededed;
      font-family: system-ui, Arial, sans-serif;
      margin: 0;
      padding: 0;
      min-height: 100vh;
    }
    .container {
      max-width: 660px;
      margin: 40px auto;
      padding: 22px 12px 40px 12px;
      background: #22223a;
      border-radius: 18px;
      box-shadow: 0 2px 24px #000a;
    }
    h1 { color: #b37bfa; text-align: center; margin-bottom: 8px;}
    .description { color: #aaa; margin-bottom: 20px; text-align: center; }
    .btn-row { text-align: center; margin-bottom: 24px;}
    button {
      background: #b37bfa; color: #fff; border: none;
      padding: 13px 23px; border-radius: 22px;
      font-weight: bold; font-size: 1.1rem;
      cursor: pointer; transition: background 0.2s;
      margin: 3px 4px;
    }
    button:hover { background: #8d57e7; }
    .copy-btn { background: #4caf50;}
    .copy-btn:hover { background: #388e3c;}
    .back-btn { background: #ff4444;}
    .back-btn:hover { background: #cc3333;}
    .loading, .error, .info, .empty {
      text-align: center; margin: 25px 0; font-size: 1rem;
    }
    .loading { color: #b37bfa; }
    .error { color: #ff7474; font-weight: bold;}
    .info { color: #6bb6ff;}
    .games-list {
      background: #181829;
      border: 2px solid #303050;
      border-radius: 16px;
      padding: 15px 20px;
      margin: 18px 0 8px 0;
      font-family: 'Courier New', monospace;
      font-size: 1.1rem;
      white-space: pre-line;
    }
    .date-header {
      color: #b37bfa; font-weight: bold; text-align: center; margin-top: 20px; margin-bottom: 8px;
    }
    @media (max-width:600px){
      .container { padding: 8px 2px;}
      button { width: 100%; margin: 8px 0;}
      .games-list { font-size: 1.0rem; }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üèÄ WNBA Schedule</h1>
    <div class="description">
      Scrapes today's WNBA games live from ESPN.<br>
      Copy the list below for use in your prop helper.
    </div>
    <div class="btn-row">
      <button id="fetchBtn">Fetch Today's Schedule</button>
      <button class="back-btn" onclick="window.location.href='wnba-player.html'">‚Üê Back to Player Tool</button>
    </div>
    <div id="info" class="info">Data loaded from ESPN WNBA schedule using a CORS proxy.</div>
    <div id="loading" class="loading" style="display:none;">Loading ESPN schedule...</div>
    <div id="error" class="error" style="display:none;"></div>
    <div id="scheduleBlock"></div>
  </div>
  <script>
    // Use a public proxy (swap to your own if needed)
    const PROXY = 'https://api.allorigins.win/raw?url=';
    const ESPN_URL = 'https://www.espn.com/wnba/schedule';

    const fetchBtn = document.getElementById('fetchBtn');
    const loading = document.getElementById('loading');
    const errorDiv = document.getElementById('error');
    const infoDiv = document.getElementById('info');
    const scheduleBlock = document.getElementById('scheduleBlock');

    fetchBtn.onclick = fetchSchedule;

    function showError(msg) {
      errorDiv.style.display = '';
      errorDiv.textContent = msg;
      loading.style.display = 'none';
      scheduleBlock.innerHTML = '';
    }
    function clearError() {
      errorDiv.textContent = '';
      errorDiv.style.display = 'none';
    }
    function showLoading(on) {
      loading.style.display = on ? '' : 'none';
    }

    function todayStr() {
      const d = new Date();
      // ESPN often uses e.g. "Tuesday, July 2"
      return d.toLocaleDateString('en-US', {weekday:'long', month:'long', day:'numeric'});
    }

    async function fetchSchedule() {
      clearError();
      showLoading(true);
      scheduleBlock.innerHTML = '';
      infoDiv.textContent = "Loading from ESPN via proxy...";
      try {
        const resp = await fetch(PROXY + encodeURIComponent(ESPN_URL));
        if (!resp.ok) throw new Error('Could not fetch ESPN schedule.');
        const html = await resp.text();
        const games = parseESPN(html);
        showLoading(false);
        if (games.length) {
          renderGames(games);
        } else {
          showNoGames();
        }
      } catch (e) {
        showLoading(false);
        showError('Failed to fetch schedule (CORS or ESPN error). Paste games manually if needed.');
        infoDiv.textContent = "If proxy fails, paste games manually.";
        showNoGames();
      }
    }

    function parseESPN(html) {
      // Try to find today's games in ESPN schedule
      const games = [];
      const doc = new DOMParser().parseFromString(html, 'text/html');
      // ESPN often uses tables with class "Table"
      // Find today's section by heading text
      const today = todayStr();
      let found = false;
      let table = null;

      // Try to find table under today's date
      Array.from(doc.querySelectorAll('h2, h3, .Table__Title, .table-caption')).forEach(header => {
        if (header.textContent.trim().includes(today)) {
          found = true;
          // Next table is likely today's games
          let el = header;
          while (el && el.nextElementSibling) {
            el = el.nextElementSibling;
            if (el.tagName === 'TABLE' || el.classList.contains('Table')) {
              table = el;
              break;
            }
          }
        }
      });

      // If found, parse rows
      if (table) {
        Array.from(table.querySelectorAll('tbody tr')).forEach(row => {
          const tds = row.querySelectorAll('td');
          if (tds.length >= 2) {
            // Team names in first 2 cells, sometimes with <a>
            let teamA = tds[0].textContent.trim();
            let teamB = tds[1].textContent.trim();
            if (teamA && teamB && !teamA.match(/Time/i) && !teamB.match(/Time/i)) {
              games.push(`${teamA} v. ${teamB}`);
            }
          }
        });
      } else {
        // Backup: parse any pair of team names in .Table or .ResponsiveTable
        doc.querySelectorAll('.Table, .ResponsiveTable').forEach(table => {
          Array.from(table.querySelectorAll('tbody tr')).forEach(row => {
            const tds = row.querySelectorAll('td');
            if (tds.length >= 2) {
              let teamA = tds[0].textContent.trim();
              let teamB = tds[1].textContent.trim();
              if (teamA && teamB && !teamA.match(/Time/i) && !teamB.match(/Time/i)) {
                games.push(`${teamA} v. ${teamB}`);
              }
            }
          });
        });
      }
      // Remove duplicates
      return Array.from(new Set(games));
    }

    function showNoGames() {
      const fallback = "Las Vegas v. New York\nConnecticut v. Dallas";
      scheduleBlock.innerHTML = `
        <div class="date-header">${todayStr()} ‚Äì No games found</div>
        <div class="games-list" id="gamesList">${fallback}</div>
        <div class="empty">No games loaded. Paste games manually if needed.</div>
        <div style="text-align:center;">
          <button class="copy-btn" onclick="copyGames()">Copy Example</button>
        </div>
      `;
    }

    function renderGames(games) {
      const formatted = games.join('\n');
      scheduleBlock.innerHTML = `
        <div class="date-header">${todayStr()}</div>
        <div class="games-list" id="gamesList">${formatted}</div>
        <div style="text-align:center;">
          <button class="copy-btn" onclick="copyGames()">Copy Games</button>
        </div>
      `;
      infoDiv.textContent = "Schedule loaded! Copy and paste into your player prop tool.";
    }

    window.copyGames = function() {
      const text = document.getElementById('gamesList').textContent;
      navigator.clipboard.writeText(text);
      const btns = document.querySelectorAll('.copy-btn');
      btns.forEach(btn => btn.textContent = 'Copied!');
      setTimeout(() => btns.forEach(btn => btn.textContent = 'Copy Games'), 1400);
    };

    // Auto-load on page open
    window.onload = fetchSchedule;
  </script>
</body>
</html>
